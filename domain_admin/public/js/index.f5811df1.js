import{_ as k,d as F,r as P}from"./index.a3a2d706.js";import{a5 as r,ak as E,S as B,o as g,c as v,Y as t,R as s,a as u,W as y,Q as V,V as T,L as q,X as h,O as H,am as L,aa as K}from"./vendor-vue.6a3d94bb.js";import{C as j}from"./ConnectStatus.17e62cce.js";import{F as M}from"./vendor-lib.55369672.js";import{a as Q}from"./element-plus.ff3f2c9d.js";import"./element-icon.ce1f4739.js";const W={domain:[{message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},X={name:"",props:{row:{type:Object,default:null}},components:{},data(){return{loading:!1,rules:W,form:{domain:"",alias:""}}},computed:{},methods:{async getData(){if(this.loading=!0,this.row){let n={id:this.row.id},a=(await this.$http.getDomainById(n)).data;this.form.domain=a.domain,this.form.alias=a.alias}this.loading=!1},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(n=>{if(n)this.confirmSubmit();else return!1})},async confirmSubmit(){let n=this.$loading({fullscreen:!0}),l={domain:this.form.domain.trim(),alias:this.form.alias.trim()},a=null;this.row?(l.id=this.row.id,a=await this.$http.updateDomainById(l)):a=await this.$http.addDomain(l),a.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(a.msg),this.$nextTick(()=>{n.close()})}},created(){this.getData()}},Y={class:"text-center"};function G(n,l,a,p,o,i){const _=r("el-input"),c=r("el-form-item"),m=r("el-form"),f=r("el-button"),C=E("loading");return B((g(),v("div",null,[t(m,{ref:"form",model:o.form,rules:o.rules,"label-width":"80px"},{default:s(()=>[t(c,{label:"\u57DF\u540D",prop:"domain"},{default:s(()=>[t(_,{type:"text",modelValue:o.form.domain,"onUpdate:modelValue":l[0]||(l[0]=b=>o.form.domain=b),placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D"},null,8,["modelValue"])]),_:1}),t(c,{label:"\u5907\u6CE8",prop:"alias"},{default:s(()=>[t(_,{type:"textarea",modelValue:o.form.alias,"onUpdate:modelValue":l[1]||(l[1]=b=>o.form.alias=b),rows:3,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),u("div",Y,[t(f,{onClick:i.handleCancel},{default:s(()=>[y("\u53D6 \u6D88")]),_:1},8,["onClick"]),t(f,{type:"primary",onClick:i.handleSubmit},{default:s(()=>[y("\u786E \u5B9A")]),_:1},8,["onClick"])])])),[[C,o.loading]])}const J=k(X,[["render",G]]),Z={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:J},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(n){this.$emit("update:visible",n)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function ee(n,l,a,p,o,i){const _=r("DataForm"),c=r("el-dialog");return g(),V(c,{title:i.dialogTitle,modelValue:i.dialogVisible,"onUpdate:modelValue":l[0]||(l[0]=m=>i.dialogVisible=m),width:"400px",center:"","append-to-body":"","lock-scroll":!1},{default:s(()=>[i.dialogVisible?(g(),V(_,{key:0,row:a.row,onOnCancel:i.handleClose,onOnSuccess:i.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):T("",!0)]),_:1},8,["title","modelValue"])}const A=k(Z,[["render",ee]]);const te={name:"ExpiredDays",props:{value:{type:Number,default:null}},components:{},data(){return{}},computed:{showValue(){return Number.isInteger(this.value)},className(){return this.showValue?this.value<3?["color--danger"]:this.value<30?["color--warning"]:["color--success"]:[]}},methods:{async getData(){}},created(){this.getData()}},ae={class:"ExpireDays"},le={key:1};function se(n,l,a,p,o,i){return g(),v("div",ae,[i.showValue?(g(),v("span",{key:0,class:q(i.className)},h(a.value),3)):(g(),v("span",le,"-"))])}const N=k(te,[["render",se]]),ne={name:"",props:{row:{type:Object,default:null}},components:{ConnectStatus:j,ExpireDays:N},data(){return{form:{domain:"",domain_url:"",ip:"",start_time:"",expire_time:"",check_time:"",connect_status:"",total_days:"",expire_days:"",create_time:"",update_time:"",detail:{issuer:{},subject:{}},real_time_expire_days:"",domain_start_time:"",domain_expire_time:"",real_time_domain_expire_days:"",alias:""},ipInfo:{isp:""}}},computed:{},methods:{async getData(){if(this.row){let n={id:this.row.id};const l=await this.$http.getDomainById(n);if(l.code!=0)return;let a=l.data;this.form.domain=a.domain,this.form.domain_url=a.domain_url,this.form.ip=a.ip,this.form.start_time=a.start_time,this.form.expire_time=a.expire_time,this.form.check_time=a.check_time,this.form.connect_status=a.connect_status,this.form.total_days=a.total_days,this.form.expire_days=a.expire_days,this.form.real_time_expire_days=a.real_time_expire_days,this.form.create_time=a.create_time,this.form.update_time=a.update_time,this.form.alias=a.alias,this.form.domain_start_time=a.domain_start_time,this.form.domain_expire_time=a.domain_expire_time,this.form.real_time_domain_expire_days=a.real_time_domain_expire_days,this.form.detail={issuer:a.detail.issuer||{},subject:a.detail.subject||{}}}},handleCancel(){this.$emit("on-cancel")},async handleUpdateRowDomainInfo(){let n=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),l={id:this.row.id};(await this.$http.updateDomainCertInfoById(l)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.getData()),n.close()},async getIpInfo(){let n={ip:this.form.ip};const l=await this.$http.getIpInfo(n);l.code==0&&(this.ipInfo=l.data)}},created(){this.getData()}},oe={class:"domain-detail"},ie={class:"mo-form-detail grid grid-cols-2 mt-sm"},re={class:"flex justify-between flex-1"},ce=u("span",null," \u66F4\u65B0",-1),de={class:"mo-form-detail",style:{"margin-top":"20px"}},me={class:"truncate"},ue={class:"text-center mt-md"};function _e(n,l,a,p,o,i){const _=r("el-link"),c=r("el-form-item"),m=r("ExpireDays"),f=r("el-form"),C=r("ConnectStatus"),b=r("Refresh"),D=r("el-icon"),S=r("el-button");return g(),v("div",oe,[u("div",ie,[t(f,{ref:"form",model:o.form,"label-width":"130px"},{default:s(()=>[t(c,{label:"\u57DF\u540D",prop:"domain"},{default:s(()=>[t(_,{underline:!1,href:o.form.domain_url,target:"_blank"},{default:s(()=>[y(h(o.form.domain),1)]),_:1},8,["href"])]),_:1}),t(c,{label:"ip",prop:"ip"},{default:s(()=>[u("span",null,h(o.form.ip||"-"),1)]),_:1}),t(c,{label:"\u57DF\u540D\u6CE8\u518C\u65F6\u95F4",prop:"create_time"},{default:s(()=>[u("span",null,h(o.form.domain_start_time||"-"),1)]),_:1}),t(c,{label:"\u57DF\u540D\u5230\u671F\u65F6\u95F4",prop:"create_time"},{default:s(()=>[u("span",null,h(o.form.domain_expire_time||"-"),1)]),_:1}),t(c,{label:"\u57DF\u540D\u5269\u4F59\u5929\u6570",prop:"create_time"},{default:s(()=>[t(m,{value:o.form.real_time_domain_expire_days},null,8,["value"])]),_:1}),t(c,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"create_time"},{default:s(()=>[u("span",null,h(o.form.create_time||"-"),1)]),_:1})]),_:1},8,["model"]),t(f,{ref:"form",model:o.form,"label-width":"130px"},{default:s(()=>[t(c,{label:"\u57DF\u540D\u8FDE\u63A5\u72B6\u6001",prop:"connect_status"},{default:s(()=>[t(C,{value:o.form.connect_status},null,8,["value"])]),_:1}),t(c,{label:"\u68C0\u67E5\u65F6\u95F4",prop:"check_time"},{default:s(()=>[u("div",re,[u("span",null,h(o.form.check_time||"-"),1),t(_,{underline:!1,type:"primary",onClick:i.handleUpdateRowDomainInfo},{default:s(()=>[t(D,null,{default:s(()=>[t(b)]),_:1}),ce]),_:1},8,["onClick"])])]),_:1}),t(c,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",prop:"start_time"},{default:s(()=>[u("span",null,h(o.form.start_time||"-"),1)]),_:1}),t(c,{label:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4",prop:"expire_time"},{default:s(()=>[u("span",null,h(o.form.expire_time||"-"),1)]),_:1}),t(c,{label:"\u8FC7\u671F\u5269\u4F59\u5929\u6570",prop:"real_time_expire_days"},{default:s(()=>[t(m,{value:o.form.real_time_expire_days},null,8,["value"])]),_:1}),t(c,{label:"\u66F4\u65B0\u65F6\u95F4",prop:"create_time"},{default:s(()=>[u("span",null,h(o.form.update_time||"-"),1)]),_:1})]),_:1},8,["model"])]),u("div",de,[t(f,{"label-width":"130px"},{default:s(()=>[t(c,{label:"\u5907\u6CE8",prop:"isp"},{default:s(()=>[u("span",me,h(o.form.alias||"-"),1)]),_:1})]),_:1})]),u("div",ue,[t(S,{type:"primary",onClick:i.handleCancel},{default:s(()=>[y("\u5173 \u95ED")]),_:1},8,["onClick"])])])}const pe=k(ne,[["render",_e]]),he={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:pe},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(n){this.$emit("update:visible",n)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose()},handleDialogClose(){this.$emit("on-success")}},created(){}};function fe(n,l,a,p,o,i){const _=r("DataForm"),c=r("el-dialog");return g(),V(c,{title:"\u57DF\u540D\u8BE6\u60C5",modelValue:i.dialogVisible,"onUpdate:modelValue":l[0]||(l[0]=m=>i.dialogVisible=m),width:"800px",center:"","append-to-body":"","lock-scroll":!1,onClose:i.handleDialogClose},{default:s(()=>[i.dialogVisible?(g(),V(_,{key:0,row:a.row,onOnCancel:i.handleClose,onOnSuccess:i.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):T("",!0)]),_:1},8,["modelValue","onClose"])}const ge=k(he,[["render",fe]]),ye={name:"",components:{DataFormDialog:A,DataDetailDialog:ge,ConnectStatus:j,ExpireDays:N},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1,dialogDetailVisible:!1}},methods:{handleEditRow(n){this.currentRow=n,this.dialogVisible=!0},async handleDeleteClick(n){let l={id:n.id};const a=await this.$http.deleteDomainById(l);a.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(a.msg)},async handleStatusChange(n){let l={id:n.id};const a=await this.$Http.function(l);a.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(a.msg)},async handleMonitorStatusChange(n,l){let a={id:n.id,is_monitor:l};const p=await this.$http.updateDomainById(a);p.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(p.msg)},async handleUpdateRowDomainInfo(n){let l=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),a={id:n.id};(await this.$http.updateDomainCertInfoById(a)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")),l.close()},handleUpdateSuccess(){this.$emit("on-success")},handleDetailSuccess(){},handleShowDetail(n){this.currentRow=n,this.dialogDetailVisible=!0}},created(){}};function be(n,l,a,p,o,i){const _=r("el-link"),c=r("el-tooltip"),m=r("el-table-column"),f=r("ExpireDays"),C=r("ConnectStatus"),b=r("Refresh"),D=r("el-icon"),S=r("Tickets"),I=r("el-switch"),O=r("Edit"),R=r("Delete"),U=r("el-popconfirm"),$=r("el-table"),z=r("DataFormDialog"),w=r("DataDetailDialog");return g(),v("div",null,[t($,H({data:a.list,stripe:"",border:""},n.$attrs,L(n.$events)),{default:s(()=>[t(m,{label:"\u57DF\u540D","header-align":"center",align:"center",prop:"domain"},{default:s(d=>[t(c,{disabled:!d.row.alias,content:d.row.alias},{default:s(()=>[t(_,{underline:!1,href:d.row.domain_url,target:"_blank"},{default:s(()=>[y(h(d.row.domain),1)]),_:2},1032,["href"])]),_:2},1032,["disabled","content"])]),_:1}),t(m,{label:"\u57DF\u540D\u5269\u4F59\u5929\u6570","header-align":"center",align:"center",width:"140",sortable:"custom",prop:"domain_expire_days"},{default:s(d=>[t(f,{value:d.row.real_time_domain_expire_days},null,8,["value"])]),_:1}),t(m,{label:"SSL\u8BC1\u4E66\u5269\u4F59\u5929\u6570","header-align":"center",align:"center",width:"180",sortable:"custom",prop:"expire_days"},{default:s(d=>[t(f,{value:d.row.real_time_expire_days},null,8,["value"])]),_:1}),t(m,{label:"\u72B6\u6001","header-align":"center",align:"center",width:"60",prop:"connect_status"},{default:s(d=>[t(C,{value:d.row.connect_status},null,8,["value"])]),_:1}),t(m,{label:"\u66F4\u65B0\u65F6\u95F4","header-align":"center",align:"center",width:"120",prop:"check_time"},{default:s(d=>[u("span",null,h(d.row.check_time_label||"-"),1)]),_:1}),t(m,{label:"\u66F4\u65B0",width:"60","header-align":"center",align:"center"},{default:s(d=>[t(_,{underline:!1,type:"primary",onClick:x=>i.handleUpdateRowDomainInfo(d.row)},{default:s(()=>[t(D,null,{default:s(()=>[t(b)]),_:1})]),_:2},1032,["onClick"])]),_:1}),t(m,{label:"\u8BE6\u7EC6","header-align":"center",align:"center",width:"60",prop:"connect_status"},{default:s(d=>[t(_,{underline:!1,type:"primary",onClick:x=>i.handleShowDetail(d.row)},{default:s(()=>[t(D,null,{default:s(()=>[t(S)]),_:1})]),_:2},1032,["onClick"])]),_:1}),t(m,{label:"\u76D1\u6D4B",width:"66","header-align":"center",align:"center"},{default:s(d=>[t(I,{modelValue:d.row.is_monitor,"onUpdate:modelValue":x=>d.row.is_monitor=x,onChange:x=>i.handleMonitorStatusChange(d.row,x)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(m,{label:"\u7F16\u8F91",width:"60","header-align":"center",align:"center"},{default:s(d=>[t(_,{underline:!1,type:"primary",onClick:x=>i.handleEditRow(d.row)},{default:s(()=>[t(D,null,{default:s(()=>[t(O)]),_:1})]),_:2},1032,["onClick"])]),_:1}),t(m,{label:"\u5220\u9664",width:"60",align:"center",prop:"tag"},{default:s(({row:d})=>[t(U,{title:"\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:x=>i.handleDeleteClick(d)},{reference:s(()=>[t(_,{underline:!1,type:"danger"},{default:s(()=>[t(D,null,{default:s(()=>[t(R)]),_:1})]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},16,["data"]),t(z,{visible:o.dialogVisible,"onUpdate:visible":l[0]||(l[0]=d=>o.dialogVisible=d),row:o.currentRow,onOnSuccess:i.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"]),t(w,{row:o.currentRow,visible:o.dialogDetailVisible,"onUpdate:visible":l[1]||(l[1]=d=>o.dialogDetailVisible=d),onOnSuccess:i.handleDetailSuccess},null,8,["row","visible","onOnSuccess"])])}const we=k(ye,[["render",be]]),De={name:"domain-list",props:{},components:{DataFormDialog:A,DataTable:we},data(){return{dataApi:F,list:[],total:0,page:1,size:20,keyword:"",pageSizeCachekey:"pageSize",loading:!0,dialogVisible:!1,export_to_file_url:P(F.exportDomainToFile),order_type:"ascending",order_prop:"expire_days"}},computed:{},methods:{resetData(){this.page=1,this.getData()},refreshData(){this.getData()},async getData(){this.loading=!0;let n={page:this.page,size:this.size,keyword:this.keyword.trim(),order_type:this.order_type,order_prop:this.order_prop};const l=await this.$http.getDomainList(n);l.code==0?(this.list=l.data.list.map(a=>(a.expire_days&&a.total_days?a.percentage=a.expire_days/a.total_days*100:a.percentage=null,a.percentage_status="exception",a.expire_days>=30?a.percentage_status="":a.expire_days>=3&&(a.percentage_status="warning"),a)),this.total=l.data.total):this.$msg.error(e.msg),this.loading=!1},async updateAllDomainCertInfoOfUser(){let n=this.$loading({fullscreen:!0});(await this.$http.updateAllDomainCertInfoOfUser()).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.resetData()),n.close()},async handleHttpRequest(n){let l=this.$loading({fullscreen:!0}),a=new FormData;a.append("file",n.file),(await this.$http.importDomainFromFile(a)).code==0&&(this.$msg.success("\u4E0A\u4F20\u6210\u529F\uFF0C\u540E\u53F0\u5BFC\u5165\u4E2D"),this.resetData()),l.close()},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},async handleExportToFile(){let l=(await this.$http.getAllDomainListOfUser()).data.list.map(p=>p.domain).join(`
`);var a=new Blob([l],{type:"text/plain;charset=utf-8"});M.saveAs(a,"domain.txt")},handleSearch(){this.resetData()},async checkDomainCert(){let n=this.$loading({fullscreen:!0});try{(await this.$http.checkDomainCert()).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success"))}catch{}finally{this.$nextTick(()=>{n.close()})}},handleSizeChange(n){localStorage.setItem(this.pageSizeCachekey,n),this.resetData()},loadPageSize(){let n=localStorage.getItem(this.pageSizeCachekey);n&&(this.size=parseInt(n))},handleExceed(n){this.$refs.upload.clearFiles();const l=n[0];l.uid=Q(),this.handleHttpRequest({file:l})},handleSortChange({column:n,prop:l,order:a}){console.log(n,l,a),this.order_type=a,this.order_prop=l,this.resetData()}},created(){this.loadPageSize(),this.getData()}},Ce={class:"app-container"},xe={class:"flex justify-between"},ve={class:"flex"};function ke(n,l,a,p,o,i){const _=r("Plus"),c=r("el-icon"),m=r("el-button"),f=r("Search"),C=r("el-input"),b=r("Refresh"),D=r("Position"),S=r("Upload"),I=r("el-upload"),O=r("Download"),R=r("DataTable"),U=r("el-pagination"),$=r("DataFormDialog"),z=E("loading");return g(),v("div",Ce,[u("div",xe,[u("div",null,[t(m,{type:"primary",onClick:i.handleAddRow},{default:s(()=>[t(c,null,{default:s(()=>[t(_)]),_:1}),y("\u6DFB\u52A0")]),_:1},8,["onClick"]),t(C,{class:"ml-sm",style:{width:"260px"},modelValue:o.keyword,"onUpdate:modelValue":l[0]||(l[0]=w=>o.keyword=w),placeholder:"\u641C\u7D22\u57DF\u540D",clearable:"",onKeypress:K(i.handleSearch,["enter"]),onClear:i.handleSearch},{append:s(()=>[t(m,{onClick:i.handleSearch},{default:s(()=>[t(c,null,{default:s(()=>[t(f)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),u("div",ve,[t(m,{onClick:i.updateAllDomainCertInfoOfUser},{default:s(()=>[t(c,null,{default:s(()=>[t(b)]),_:1}),y("\u5168\u90E8\u66F4\u65B0")]),_:1},8,["onClick"]),t(m,{class:"margin-left--auto",onClick:i.checkDomainCert},{default:s(()=>[t(c,null,{default:s(()=>[t(D)]),_:1}),y("\u8BC1\u4E66\u68C0\u67E5")]),_:1},8,["onClick"]),t(I,{class:"ml-sm",ref:"upload",action:"action",accept:".txt",limit:1,"on-exceed":i.handleExceed,"show-file-list":!1,"http-request":i.handleHttpRequest},{default:s(()=>[t(m,null,{default:s(()=>[t(c,null,{default:s(()=>[t(S)]),_:1}),y("\u5BFC\u5165")]),_:1})]),_:1},8,["on-exceed","http-request"]),t(m,{class:"ml-sm",onClick:i.handleExportToFile},{default:s(()=>[t(c,null,{default:s(()=>[t(O)]),_:1}),y("\u5BFC\u51FA")]),_:1},8,["onClick"])])]),B(t(R,{class:"mt-md",list:o.list,onOnSuccess:i.resetData,onSortChange:i.handleSortChange},null,8,["list","onOnSuccess","onSortChange"]),[[z,o.loading]]),t(U,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:o.total,"page-size":o.size,"onUpdate:page-size":l[1]||(l[1]=w=>o.size=w),"current-page":o.page,"onUpdate:current-page":l[2]||(l[2]=w=>o.page=w),onCurrentChange:i.getData,onSizeChange:i.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"]),t($,{visible:o.dialogVisible,"onUpdate:visible":l[3]||(l[3]=w=>o.dialogVisible=w),onOnSuccess:i.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const $e=k(De,[["render",ke]]);export{$e as default};
